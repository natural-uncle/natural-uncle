<!doctype html>
<meta charset="utf-8">
<title>Cloudinary ä¸Šå‚³ï¼ˆæ‹¼è²¼ç…§ï¼‰ï¼‹ JSON ç”¢ç”Ÿå™¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="noindex,nofollow">
<script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
<style>
  :root{--blue:#2563eb;--bg:#0f172a;--panel:#111827;--text:#e5e7eb;--muted:#9ca3af;--ok:#16a34a}
  body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC",Arial;margin:24px;color:#0b1220}
  .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .btn{display:inline-flex;align-items:center;gap:.4rem;padding:.7rem 1rem;border-radius:.6rem;background:var(--blue);color:#fff;border:0;cursor:pointer;font-weight:700}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .gray{background:#0f172a;color:#e5e7eb;padding:12px;border-radius:.6rem;white-space:pre;overflow:auto;border:1px solid #1f2937}
  input,select{width:100%;padding:.6rem .7rem;border:1px solid #cbd5e1;border-radius:.5rem}
  label{display:block;margin:.5rem 0 .25rem;font-weight:600}
  .badge{display:inline-block;padding:.25rem .55rem;border-radius:.5rem;background:#e2e8f0;margin-left:.5rem;font-size:.8rem}
  .note{background:#f1f5f9;border-left:4px solid var(--blue);padding:.75rem 1rem;border-radius:.5rem;margin:.5rem 0 1rem}
  .muted{color:#64748b}
  .preview{margin-top:10px;border:1px dashed #cbd5e1;border-radius:.6rem;min-height:160px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .preview img{max-width:100%;height:auto;display:block}
</style>

<h1>Cloudinary ä¸Šå‚³ï¼ˆæ‹¼è²¼ç…§ï¼‰ï¼‹ JSON ç”¢ç”Ÿå™¨</h1>
<p class="note">Cloud name = <b>dijzndzw2</b>ã€Unsigned preset = <b>nu-unsigned</b>ã€Folder = <b>natural-uncle</b>ã€‚æ­¥é©Ÿï¼š<b>ä¸Šå‚³æ‹¼è²¼ç…§ â†’ ç”¢ç”Ÿ JSON â†’ ä¸€éµè¤‡è£½</b>ï¼Œå†è²¼å› <code>/works/manifest.json</code> é™£åˆ—ä¸­ã€‚</p>

<div class="row">
  <div>
    <label>Cloud Name</label>
    <input id="cloudName" value="dijzndzw2" readonly>
    <label>Unsigned Upload Preset</label>
    <input id="preset" value="nu-unsigned" readonly>
    <label>Folderï¼ˆå¯æ”¹ï¼‰</label>
    <input id="folder" value="natural-uncle">

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" id="btnUpload">ä¸Šå‚³æ‹¼è²¼ç…§</button>
      <span id="pidImage" class="badge">å°šæœªä¸Šå‚³</span>
      <button class="btn" id="btnReupload" type="button" disabled>é‡æ–°ä¸Šå‚³</button>
    </div>

    <div class="preview" id="preview"><span class="muted">ä¸Šå‚³å®Œæˆå¾Œæœƒé¡¯ç¤ºé è¦½</span></div>

    <label style="margin-top:16px">æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰</label>
    <input id="date" placeholder="ä¾‹å¦‚ï¼š2025-09-03">
    <label>æœå‹™</label>
    <select id="service">
      <option>å†·æ°£</option><option>æ´—è¡£æ©Ÿ</option><option>æ°´å¡”</option><option>æ°´ç®¡</option>
    </select>
    <label>åŸå¸‚</label><input id="city" placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚">
    <label>è¡Œæ”¿å€</label><input id="area" placeholder="ä¾‹å¦‚ï¼šå¤§å®‰å€">
    <label>å‚™è¨»</label><input id="note" placeholder="é¸å¡«ï¼šç¾å ´ç‹€æ³ / æˆæœé‡é»">

    <button class="btn" id="gen" style="margin-top:12px" disabled>ç”¢ç”Ÿ JSON ç‰‡æ®µ</button>
  </div>

  <div>
    <label>çµæœï¼ˆè¤‡è£½è²¼å› works/manifest.json é™£åˆ—ä¸­ï¼‰</label>
    <div style="display:flex;align-items:center;gap:8px;margin:8px 0">
      <button class="btn" id="copyBtn" disabled>ğŸ“‹ ä¸€éµè¤‡è£½</button>
      <span id="copyStatus" class="muted"></span>
    </div>
    <textarea id="out" class="gray" rows="18" readonly></textarea>
  </div>
</div>

<script>
/* é è¨­æ—¥æœŸ = ä»Šå¤© */
(function(){ const t=new Date(); const pad=n=>n<10?'0'+n:n; document.getElementById('date').value = `${t.getFullYear()}-${pad(t.getMonth()+1)}-${pad(t.getDate())}`; })();

function openWidget(){
  const cloudName = document.getElementById('cloudName').value.trim();
  const preset = document.getElementById('preset').value.trim();
  const folder = document.getElementById('folder').value.trim();

  const widget = cloudinary.createUploadWidget({
    cloudName, uploadPreset: preset, folder: folder || undefined,
    multiple: false,
    sources: ['local','camera','url','google_drive'],
    clientAllowedFormats: ['jpg','jpeg','png','webp','heic'],
    maxFileSize: 15 * 1024 * 1024
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      const pid = result.info.public_id;
      const cdn = `https://res.cloudinary.com/${cloudName}/image/upload/f_auto,q_auto,w_1600/${pid.split('/').map(encodeURIComponent).join('/')}`;
      document.getElementById('pidImage').textContent = pid;
      document.getElementById('pidImage').style.background = '#bbf7d0';
      document.getElementById('preview').innerHTML = `<img src="${cdn}" alt="é è¦½">`;
      document.getElementById('gen').disabled = false;
      document.getElementById('btnReupload').disabled = false;
    }
  });
  widget.open();
}

document.getElementById('btnUpload').onclick = openWidget;
document.getElementById('btnReupload').onclick = openWidget;

document.getElementById('gen').onclick = ()=>{
  const pid = document.getElementById('pidImage').textContent;
  if(!pid || pid.includes('å°šæœª')){ alert('è«‹å…ˆä¸Šå‚³æ‹¼è²¼ç…§'); return; }
  const out = buildEntry(pid);
  document.getElementById('out').value = JSON.stringify(out, null, 2);
  document.getElementById('copyBtn').disabled = false;
  document.getElementById('copyStatus').textContent = '';
};

document.getElementById('copyBtn').onclick = async ()=>{
  const text = document.getElementById('out').value.trim();
  if(!text){ alert('æ²’æœ‰å¯è¤‡è£½çš„å…§å®¹'); return; }
  try{
    await navigator.clipboard.writeText(text);
    document.getElementById('copyStatus').textContent = 'âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿';
    setTimeout(()=>document.getElementById('copyStatus').textContent='', 1800);
  }catch{
    document.getElementById('copyStatus').textContent = 'âŒ è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰';
  }
};

function buildEntry(publicId){
  const pad = n => n<10? '0'+n : ''+n;
  const t = new Date(); const today = `${t.getFullYear()}-${pad(t.getMonth()+1)}-${pad(t.getDate())}`;
  // ç°¡å–® idï¼šæ—¥æœŸ + äº‚ç¢¼
  const id = `${today}-${Math.random().toString(36).slice(2,6).toUpperCase()}`;
  return {
    id,
    date: document.getElementById('date').value || today,
    service: document.getElementById('service').value,
    city: document.getElementById('city').value || '',
    area: document.getElementById('area').value || '',
    note: document.getElementById('note').value || '',
    provider: 'cloudinary',
    image: publicId
  };
}
</script>
