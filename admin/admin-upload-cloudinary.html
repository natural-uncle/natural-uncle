<!doctype html>
<meta charset="utf-8">
<title>å¤šå¼µæ‹¼è²¼ç…§ ä¸Šå‚³ï¼‹manifest JSON ç”¢ç”Ÿå™¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="noindex,nofollow">
<script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
<style>
  :root{--blue:#2563eb;--ok:#16a34a;--muted:#64748b}
  body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC",Arial;margin:24px;color:#0b1220}
  .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .btn{display:inline-flex;align-items:center;gap:.4rem;padding:.6rem .9rem;border-radius:.55rem;background:var(--blue);color:#fff;border:0;cursor:pointer;font-weight:700}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn-ghost{background:#0f172a;color:#e5e7eb}
  input,select{width:100%;padding:.55rem .7rem;border:1px solid #cbd5e1;border-radius:.5rem}
  label{display:block;margin:.5rem 0 .25rem;font-weight:600}
  .badge{display:inline-block;padding:.2rem .5rem;border-radius:.5rem;background:#e2e8f0;margin-left:.5rem;font-size:.8rem}
  .note{background:#f1f5f9;border-left:4px solid var(--blue);padding:.75rem 1rem;border-radius:.5rem;margin:.5rem 0 1rem}
  .muted{color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media(min-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }
  .card{border:1px solid #e5e7eb;border-radius:.6rem;padding:8px}
  .thumb{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:.4rem;border:1px solid #e5e7eb;background:#f8fafc}
  .rowbtn{display:flex;gap:6px;margin-top:6px}
  .gray{background:#0f172a;color:#e5e7eb;padding:12px;border-radius:.6rem;white-space:pre;overflow:auto;border:1px solid #1f2937}
</style>

<h1>å¤šå¼µæ‹¼è²¼ç…§ ä¸Šå‚³ï¼‹manifest JSON ç”¢ç”Ÿå™¨</h1>
<p class="note">
  Cloud name = <b>dijzndzw2</b>ã€Unsigned preset = <b>nu-unsigned</b>ã€Folder = <b>natural-uncle</b>ã€‚<br>
  ä¸€ç­†æ¡ˆä¾‹å¯ä¸Šå‚³ <b>2â€“6 å¼µã€Œæ‹¼è²¼ç…§ã€</b>ï¼Œæ’åºå¯èª¿æ•´ï¼›å®Œæˆå¾Œç”¢ç”Ÿ <code>images: []</code> é™£åˆ—ä¸¦ä¸€éµè¤‡è£½ã€‚
</p>

<div class="row">
  <section>
    <label>Cloud Name</label>
    <input id="cloudName" value="dijzndzw2" readonly>
    <label>Unsigned Upload Preset</label>
    <input id="preset" value="nu-unsigned" readonly>
    <label>Folderï¼ˆå¯æ”¹ï¼‰</label>
    <input id="folder" value="natural-uncle">

    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" id="btnUpload">ä¸Šå‚³æ‹¼è²¼ç…§ï¼ˆå¯å¤šé¸ï¼‰</button>
      <span class="badge"><span id="count">0</span> å¼µ</span>
      <button class="btn btn-ghost" id="btnClear" type="button">æ¸…ç©º</button>
    </div>

    <div style="margin-top:12px">
      <div class="grid" id="grid"></div>
      <p class="muted" id="hint" style="margin-top:8px">å»ºè­° 2â€“6 å¼µï¼›ç¬¬ä¸€å¼µæ”¾æœ€å…·ä»£è¡¨æ€§çš„å°æ¯”ç…§ã€‚</p>
    </div>

    <label style="margin-top:16px">æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰</label>
    <input id="date" placeholder="ä¾‹å¦‚ï¼š2025-09-03">
    <label>æœå‹™</label>
    <select id="service">
      <option>å†·æ°£</option><option>æ´—è¡£æ©Ÿ</option><option>æ°´å¡”</option><option>æ°´ç®¡</option>
    </select>
    <label>åŸå¸‚</label><input id="city" placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚">
    <label>è¡Œæ”¿å€</label><input id="area" placeholder="ä¾‹å¦‚ï¼šå¤§å®‰å€">
    <label>å‚™è¨»</label><input id="note" placeholder="é¸å¡«ï¼šç¾å ´ç‹€æ³ / æˆæœé‡é»">

    <button class="btn" id="gen" style="margin-top:12px">ç”¢ç”Ÿ JSON ç‰‡æ®µ</button>
  </section>

  <section>
    <label>çµæœï¼ˆè¤‡è£½è²¼å› works/manifest.json é™£åˆ—ä¸­ï¼‰</label>
    <div style="display:flex;align-items:center;gap:8px;margin:8px 0">
      <button class="btn" id="copyBtn" disabled>ğŸ“‹ ä¸€éµè¤‡è£½</button>
      <span id="copyStatus" class="muted"></span>
    </div>
    <textarea id="out" class="gray" rows="22" readonly></textarea>
  </section>
</div>

<script>
/* é è¨­æ—¥æœŸ = ä»Šå¤© */
(function(){ const t=new Date(); const pad=n=>n<10?'0'+n:n; document.getElementById('date').value = `${t.getFullYear()}-${pad(t.getMonth()+1)}-${pad(t.getDate())}`; })();

/* ===== Cloudinary å¤šå¼µä¸Šå‚³ï¼ˆæ”¶é›† public_id é™£åˆ—ï¼‰ ===== */
let uploaded = []; // [{pid, urlThumb, urlFull}]

function buildCloudinaryUrl(cloudName, publicId, w){
  const safePath = publicId.split('/').map(encodeURIComponent).join('/'); // åˆ†æ®µç·¨ç¢¼
  return `https://res.cloudinary.com/${cloudName}/image/upload/f_auto,q_auto,w_${w}/${safePath}`;
}

function renderGrid(){
  const grid = document.getElementById('grid');
  const cloud = document.getElementById('cloudName').value.trim();
  document.getElementById('count').textContent = uploaded.length;

  if(uploaded.length===0){ grid.innerHTML=''; return; }

  grid.innerHTML = uploaded.map((x, i)=>{
    const thumb = x.urlThumb || buildCloudinaryUrl(cloud, x.pid, 800);
    return `
      <div class="card">
        <img class="thumb" src="${thumb}" alt="æ‹¼è²¼ç…§ ${i+1}">
        <div class="rowbtn">
          <button class="btn" data-act="up" data-i="${i}" ${i===0?'disabled':''}>â†‘</button>
          <button class="btn" data-act="down" data-i="${i}" ${i===uploaded.length-1?'disabled':''}>â†“</button>
          <button class="btn" data-act="del" data-i="${i}" style="background:#ef4444">åˆªé™¤</button>
        </div>
      </div>`;
  }).join('');

  grid.querySelectorAll('button').forEach(btn=>{
    btn.onclick = ()=>{
      const i = +btn.dataset.i, act = btn.dataset.act;
      if(act==='del'){ uploaded.splice(i,1); renderGrid(); return; }
      if(act==='up' && i>0){ [uploaded[i-1],uploaded[i]]=[uploaded[i],uploaded[i-1]]; renderGrid(); return; }
      if(act==='down' && i<uploaded.length-1){ [uploaded[i+1],uploaded[i]]=[uploaded[i],uploaded[i+1]]; renderGrid(); return; }
    };
  });
}

function openWidget(){
  const cloudName = document.getElementById('cloudName').value.trim();
  const preset = document.getElementById('preset').value.trim();
  const folder = document.getElementById('folder').value.trim();

  const widget = cloudinary.createUploadWidget({
    cloudName, uploadPreset: preset, folder: folder || undefined,
    multiple: true, maxFiles: 6,
    sources: ['local','camera','url','google_drive'],
    clientAllowedFormats: ['jpg','jpeg','png','webp','heic'],
    maxFileSize: 15 * 1024 * 1024
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      const pid = result.info.public_id;
      uploaded.push({ pid });
      if(uploaded.length>6){ uploaded = uploaded.slice(0,6); alert('æœ€å¤š 6 å¼µï¼Œå·²æˆªæ–·ã€‚'); }
      renderGrid();
    }
  });
  widget.open();
}

document.getElementById('btnUpload').onclick = openWidget;
document.getElementById('btnClear').onclick = ()=>{ uploaded=[]; renderGrid(); };

/* ===== ç”¢ç”Ÿ JSONï¼šimages é™£åˆ— ===== */
function buildEntry(pids){
  const pad = n => n<10? '0'+n : ''+n;
  const t = new Date(); const today = `${t.getFullYear()}-${pad(t.getMonth()+1)}-${pad(t.getDate())}`;
  const id = `${today}-${Math.random().toString(36).slice(2,6).toUpperCase()}`;
  return {
    id,
    date: document.getElementById('date').value || today,
    service: document.getElementById('service').value,
    city: document.getElementById('city').value || '',
    area: document.getElementById('area').value || '',
    note: document.getElementById('note').value || '',
    provider: 'cloudinary',
    images: pids
  };
}

document.getElementById('gen').onclick = ()=>{
  if(uploaded.length<2){ alert('è«‹è‡³å°‘ä¸Šå‚³ 2 å¼µæ‹¼è²¼ç…§'); return; }
  const pids = uploaded.map(x=>x.pid);
  const obj = buildEntry(pids);
  document.getElementById('out').value = JSON.stringify(obj, null, 2);
  document.getElementById('copyBtn').disabled = false;
  document.getElementById('copyStatus').textContent = '';
};

/* ä¸€éµè¤‡è£½ */
document.getElementById('copyBtn').onclick = async ()=>{
  const text = document.getElementById('out').value.trim();
  if(!text){ alert('æ²’æœ‰å¯è¤‡è£½çš„å…§å®¹'); return; }
  try{
    await navigator.clipboard.writeText(text);
    document.getElementById('copyStatus').textContent = 'âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿';
    setTimeout(()=>document.getElementById('copyStatus').textContent='', 1800);
  }catch{
    document.getElementById('copyStatus').textContent = 'âŒ è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰';
  }
};
</script>
