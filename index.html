<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>自然大叔｜冷氣・洗衣機・水塔・自來水管清洗</title>
  <meta name="description" content="專業到府清洗：冷氣、直立式洗衣機、水塔、自來水管。透明價格、到府快速、提供保固與發票。立即以 LINE/電話預約。" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Favicon / Icons -->
  <link rel="icon" type="image/png" href="logo-mark.jpg" sizes="32x32">
  <link rel="apple-touch-icon" href="logo-mark.jpg" sizes="180x180">

  <!-- Open Graph -->
  <meta property="og:title" content="自然大叔｜冷氣・洗衣機・水塔・自來水管清洗">
  <meta property="og:description" content="專業到府清洗｜透明價格｜完工保固｜可開立發票">
  <meta property="og:image" content="og.jpg">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yourdomain.com/">

  <!-- （可選）SaaS 圖片預連線 -->
  <link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
  <link rel="preconnect" href="https://ik.imagekit.io" crossorigin>
  <link rel="preconnect" href="https://ucarecdn.com" crossorigin>
  <link rel="preconnect" href="https://imagedelivery.net" crossorigin>

  <!-- 結構化資料 -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"CleaningService",
    "name":"自然大叔",
    "image":"assets/logo-mark.jpg",
    "url":"https://yourdomain.com",
    "telephone":"+886-912-356-331",
    "priceRange":"$$",
    "areaServed":"台北、新北、基隆",
    "openingHours":"Mo-Sa 09:00-20:00",
    "sameAs":["https://line.me/R/ti/p/@uncle888"],
    "serviceType":["冷氣清洗","直立式洗衣機清洗","水塔清洗","自來水管清洗"],
    "address":{"@type":"PostalAddress","addressLocality":"台北市","addressRegion":"台北市","postalCode":"100","addressCountry":"TW"},
    "potentialAction":{"@type":"ReserveAction","target":"https://yourdomain.com/booking","result":{"@type":"Reservation","name":"家電清洗預約"}}
  }</script>

  <style>
    html{scroll-behavior:smooth}
    :root{
      --bg:#f3f5f9; --text:#0b1220; --muted:#5b6b7f;
      --card-bg:#ffffff; --border:#d7deea;
      --primary:#06C755; --primary-hover:#05b451;
      --success:#0aa57a; --success-hover:#078d67;
      --ghost-bg:#ffffff; --ghost-border:#c9d3e3;
      --accent:#2563eb; --text-strong:#0a0f1a;
    }
    @media (prefers-color-scheme: dark){
      :root{--bg:#0b1220; --text:#e7edf6; --muted:#afbbce;
        --card-bg:#0f172a; --border:#233046;
        --ghost-bg:#0f172a; --ghost-border:#2a3a53;
        --accent:#60a5fa; --text-strong:#ffffff;}
    }
    body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Arial}
    .muted{color:var(--muted)}
    h1,h2,h3{color:var(--text-strong);font-weight:800}
    .card{background:var(--card-bg);border:1px solid var(--border);border-radius:1rem;padding:1.25rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:.75rem 1.25rem;border-radius:.75rem;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:var(--ghost-bg);border:1px solid var(--ghost-border);color:var(--text)}

    /* 工作日誌縮圖 */
    .diary-thumb{aspect-ratio:4/3;width:100%;object-fit:cover;border-radius:.5rem;border:1px solid var(--border)}

    /* Lightbox */
    #lightbox{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:100}
    #lightbox img{max-width:90%;max-height:85%;border-radius:.5rem;box-shadow:0 8px 30px rgba(0,0,0,.6)}
    #lightbox .close{position:absolute;top:20px;right:24px;font-size:2rem;color:#fff;cursor:pointer}
  </style>
</head>

<body id="top">
  <!-- Header / Hero / Services / Pricing / Process / SOP ... (保持不變，這裡略) -->

  <!-- ★ 工作照片日誌 -->
  <section id="cases" class="max-w-6xl mx-auto px-4 py-12">
    <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3 mb-6">
      <div>
        <h2 class="text-2xl md:text-3xl font-bold">工作照片日誌</h2>
        <p class="muted text-sm mt-1">顯示每次清洗的拼貼照（<span id="workCount">0</span> 筆）</p>
      </div>
      <div class="flex flex-col sm:flex-row gap-2">
        <select id="filterService" class="btn btn-ghost py-2 px-3">
          <option value="all">全部服務</option>
          <option value="冷氣">冷氣清洗</option>
          <option value="洗衣機">直立式洗衣機清洗</option>
          <option value="水塔">水塔清洗</option>
          <option value="水管">自來水管清洗</option>
        </select>
        <select id="filterDate" class="btn btn-ghost py-2 px-3">
          <option value="7">近 7 天</option>
          <option value="30">近 30 天</option>
          <option value="1">本日</option>
          <option value="all">全部</option>
        </select>
        <input id="filterKeyword" class="btn btn-ghost py-2 px-3" placeholder="關鍵字（區域/備註）" />
      </div>
    </div>

    <!-- 4 欄縮圖 -->
    <div id="workGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>

    <div class="mt-6 text-center">
      <button id="btnMore" class="btn btn-primary px-6">載入更多</button>
    </div>
  </section>

  <!-- Lightbox -->
  <div id="lightbox">
    <span class="close">&times;</span>
    <img src="" alt="放大圖片">
  </div>

  <script>
  const CONFIG = {
    manifestPath:'/works/manifest.json',
    cloudinary:{cloudName:'dijzndzw2'},
    imagekit:{baseUrl:'https://ik.imagekit.io/YOUR_IMAGEKIT_ID'},
    uploadcare:{baseCdn:'https://ucarecdn.com'},
    cloudflare:{accountHash:'YOUR_ACCOUNT_HASH',variant:'public'}
  };
  const $=s=>document.querySelector(s);
  function daysBetween(d){const ms=(new Date())-new Date(d+'T00:00:00');return Math.floor(ms/86400000)}
  function matchKeyword(w,kw){if(!kw)return true;kw=kw.trim();return[w.city,w.area,w.service,w.note].some(x=>(x||'').includes(kw))}
  function buildUrl(provider,idOrUrl,width=1600){
    if(!idOrUrl)return'';if(/^https?:\/\//i.test(idOrUrl))return idOrUrl;
    switch((provider||'').toLowerCase()){
      case 'cloudinary':{const c=CONFIG.cloudinary.cloudName;const path=String(idOrUrl).split('/').map(encodeURIComponent).join('/');return`https://res.cloudinary.com/${c}/image/upload/f_auto,q_auto,w_${width}/${path}`;}
      case 'imagekit':{const base=CONFIG.imagekit.baseUrl.replace(/\/$/,'');return`${base}/${idOrUrl}?tr=f-auto,q-85,w-${width}`;}
      case 'uploadcare':{const cdn=CONFIG.uploadcare.baseCdn.replace(/\/$/,'');return`${cdn}/${idOrUrl}/-/format/auto/-/quality/smart/-/resize/${width}/`;}
      case 'cloudflare':{const{accountHash,variant}=CONFIG.cloudflare;return`https://imagedelivery.net/${accountHash}/${encodeURIComponent(idOrUrl)}/${encodeURIComponent(variant)}`;}
      default:return idOrUrl;
    }
  }
  function workCard(w){
    const when=daysBetween(w.date)===0?'（本日）':'';
    const title=`${w.date}${when}・${w.city||''}${w.area||''}・${w.service||''}`;
    const prov=(w.provider||'url').toLowerCase();
    const thumb=buildUrl(prov,w.image,600);
    const full=buildUrl(prov,w.image,1600);
    const alt=`${w.city||''}${w.area||''}${w.service||''} 清洗拼貼`;
    return`
      <article class="card p-0 overflow-hidden">
        <div class="p-4 border-b flex items-center justify-between">
          <div class="text-sm font-semibold">${title}</div>
          <span class="text-xs muted">${w.id||''}</span>
        </div>
        <div class="p-4">
          <img class="diary-thumb cursor-pointer" src="${thumb}" data-full="${full}" alt="${alt}" loading="lazy" width="600" height="450">
          ${w.note?`<p class="mt-3 text-sm muted">${w.note}</p>`:''}
        </div>
      </article>`;
  }
  let ALL_WORKS=[],currentFiltered=[],pageSize=8,page=1;
  async function loadWorks(){
    try{const res=await fetch(CONFIG.manifestPath+'?v='+Date.now(),{cache:'no-store'});
      if(!res.ok)throw new Error('manifest 載入失敗');
      const data=await res.json();
      if(!Array.isArray(data))throw new Error('manifest 格式應為陣列');
      ALL_WORKS=data.map(x=>({id:x.id||crypto.randomUUID(),date:x.date||new Date().toISOString().slice(0,10),service:x.service||'',city:x.city||'',area:x.area||'',note:x.note||'',provider:(x.provider||'url').toLowerCase(),image:x.image}));
    }catch(e){console.error(e);ALL_WORKS=[]}
  }
  function applyFilters(){
    const svc=$('#filterService')?.value||'all';const range=$('#filterDate')?.value||'7';const kw=$('#filterKeyword')?.value||'';
    const filtered=ALL_WORKS.filter(w=>svc==='all'?true:w.service===svc).filter(w=>{
      if(range==='all')return true;if(range==='1')return daysBetween(w.date)<=0;if(range==='7')return daysBetween(w.date)<=7;if(range==='30')return daysBetween(w.date)<=30;return true;
    }).filter(w=>matchKeyword(w,kw)).sort((a,b)=>b.date.localeCompare(a.date));
    currentFiltered=filtered;const cnt=$('#workCount');if(cnt)cnt.textContent=filtered.length;page=1;renderPage();
  }
  function renderPage(){
    const grid=$('#workGrid');if(!grid)return;
    if(currentFiltered.length===0){grid.innerHTML=`<div class="muted text-sm">目前尚無工作日誌</div>`;$('#btnMore')?.classList.add('is-hidden');return}
    const slice=currentFiltered.slice(0,page*pageSize);
    grid.innerHTML=slice.map(workCard).join('');
    $('#btnMore')?.classList.toggle('is-hidden',slice.length>=currentFiltered.length);
    bindLightbox();
  }
  function bindLightbox(){
    document.querySelectorAll('.diary-thumb').forEach(img=>{
      img.onclick=()=>{const full=img.dataset.full;const lb=$('#lightbox');const lbImg=$('#lightbox img');lbImg.src=full;lb.style.display='flex'}
    });
  }
  async function initDiary(){
    await loadWorks();
    $('#filterService')?.addEventListener('change',applyFilters);
    $('#filterDate')?.addEventListener('change',applyFilters);
    $('#filterKeyword')?.addEventListener('input',()=>applyFilters());
    $('#btnMore')?.addEventListener('click',()=>{page+=1;renderPage()});
    applyFilters();
  }
  initDiary();
  // Lightbox 關閉
  $('#lightbox .close').onclick=()=>{$('#lightbox').style.display='none';$('#lightbox img').src=''}
  $('#lightbox').onclick=e=>{if(e.target.id==='lightbox'){$('#lightbox').style.display='none';$('#lightbox img').src=''}}
  </script>
</body>
</html>
