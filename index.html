<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>自然大叔｜官方網站</title>
<meta content="專業到府清洗：冷氣、直立式洗衣機、水塔、自來水管。透明價格、到府快速、提供保固與發票。立即以 LINE/電話預約。" name="description"/>

<div class="fixed inset-0 hidden z-50" id="offer-modal"><div class="offer-overlay absolute inset-0" data-close="offer"></div><div class="offer-panel relative max-w-xl w-[92%] p-6 md:p-7 rounded-2xl shadow-2xl"><button aria-label="關閉" class="offer-close absolute top-2 right-2" data-close="offer">×</button><h3 class="offer-title text-xl font-bold mb-2" id="offer-title">優惠內容</h3><div class="offer-body text-sm leading-6" id="offer-body"></div></div></div>

<!-- Announcement Modal (beautified, no close X) -->
<style>
  #offer-modal.hidden { display: none; }
  #offer-modal .modal-overlay { opacity: 0; transition: opacity .2s ease; }
  #offer-modal .modal-panel { opacity: 0; transform: translateY(8px) scale(.98); transition: transform .2s ease, opacity .2s ease; }
  #offer-modal.open .modal-overlay { opacity: 1; }
  #offer-modal.open .modal-panel { opacity: 1; transform: translateY(0) scale(1); }
</style>
<div id="offer-modal" class="fixed inset-0 hidden z-50" role="dialog" aria-modal="true" aria-labelledby="offer-title">
  <div class="modal-overlay absolute inset-0 bg-black/50"></div>
  <div class="modal-panel relative mx-auto my-12 max-w-lg w-[92%] rounded-2xl bg-white shadow-2xl p-6">
    <div class="flex items-start gap-3 mb-3">
      <div class="shrink-0 w-8 h-8 rounded-full bg-amber-600 text-white flex items-center justify-center text-sm">告</div>
      <div class="flex-1">
        <h3 id="offer-title" class="text-xl font-extrabold text-gray-900">優惠內容</h3>
      </div>
    </div>
    <div id="offer-body" class="text-base leading-7 text-gray-700"></div>
    <div class="mt-6 text-right">
      <button id="offer-close-2" class="inline-flex items-center px-4 py-2 rounded-xl border border-amber-600 text-amber-700 hover:bg-amber-50">關閉</button>
    </div>
  </div>
</div>
<script>
(function(){
  // Modal open/close
  const modal = document.getElementById('offer-modal');
  const overlay = modal?.querySelector('.modal-overlay');
  function closeModal(){
    if (!modal) return;
    modal.classList.remove('open');
    setTimeout(()=>{ modal.classList.add('hidden'); document.body.style.overflow=''; }, 200);
  }
  document.getElementById('offer-close-2')?.addEventListener('click', closeModal);
  modal?.addEventListener('click', (e)=>{ if (e.target === modal || e.target === overlay) closeModal(); });

  window.openModal = function(item){
    if (!modal) return;
    const titleEl = document.getElementById('offer-title');
    const bodyEl = document.getElementById('offer-body');
    if (titleEl) titleEl.textContent = item?.title || '內容';
    if (bodyEl) bodyEl.innerHTML = item?.bodyHtml || (item?.body || '');
    modal.classList.remove('hidden');
    void modal.offsetWidth;
    modal.classList.add('open');
    document.body.style.overflow = 'hidden';
  };
})();
</script>
<script>
(function(){
  // Safe loader with relative and absolute fallback
  async function loadJSON(){
    const tryLoad = async (u) => {
      const r = await fetch(u);
      if (!r.ok) throw new Error('HTTP '+r.status);
      return r.json();
    };
    try { return await tryLoad('data/announcements.json'); } catch(_){}
    try { return await tryLoad('/data/announcements.json'); } catch(_){}
    return [];
  }

  function render(list){
    const el = document.getElementById('news-list');
    if (!el) return;
    const now = new Date();
    const items = (list||[])
      .filter(x => (!x.start || new Date(x.start) <= now) && (!x.end || now <= new Date(x.end)))
      .sort((a,b) => (a.priority ?? 99) - (b.priority ?? 99) || new Date(b.start||0) - new Date(a.start||0));

    if (!items.length){
      el.innerHTML = '<div class="text-sm text-gray-500">目前沒有最新公告。</div>';
      return;
    }

    el.innerHTML = items.map(x => `
      <article class="rounded-lg border border-amber-200 bg-white p-4 md:p-5 shadow" data-id="\${x.id||''}">
        <div class="flex items-center gap-2 mb-2">
          <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-amber-600 text-white text-xs">告</span>
          <h3 class="font-bold text-gray-900">\${x.title||''}</h3>
        </div>
        \${x.body ? `<p class="text-sm text-gray-600 mb-2">\${x.body}</p>` : ''}
        \${x.hideBodyHtmlInList === true ? '' : (x.bodyHtml || '')}
        \${x.ctaUrl ? `<a class="btn btn-primary mt-3 inline-flex items-center" href="\${x.ctaUrl}" data-id="\${x.id||''}" data-modal="\${x.modal===true?'1':'0'}">\${x.ctaText||'瞭解更多'}</a>` : ''}
      </article>
    `).join('');
  }

  // Delegate click to open modal
  function bind(){
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a[data-modal="1"]');
      if (!a) return;
      const id = a.getAttribute('data-id') || a.closest('[data-id]')?.getAttribute('data-id');
      if (!id) return;
      e.preventDefault();
      loadJSON().then(list => {
        const item = (list||[]).find(x => String(x.id) === String(id));
        if (item) window.openModal(item);
      });
    }, true);
  }

  async function init(){
    const list = await loadJSON();
    render(list);
    bind();
  }

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>
</body>
</html>
